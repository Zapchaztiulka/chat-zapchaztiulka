import{a as v,u as w,b as L,r as s,j as e,L as P,M as Q,i as T,A as V,S as N,c as q,d as D,e as o,f as z,Q as E,g as G,h as K,k as X,l as k}from"./index-9eed4438.js";import{S as Y,D as Z}from"./SearchBtnMini-1027216d.js";import{C as ee,M,a as te}from"./Container-b0532d94.js";const se=()=>{const n=v(),u=w(L),[f,x]=s.useState(!1),[l,y]=s.useState(""),[j,d]=s.useState(1),t=s.useRef(j),[i,h]=s.useState(null),[a,r]=s.useState(!1),[C,S]=s.useState(null),[R,I]=s.useState(!1),p=s.useRef(null),b=localStorage.getItem("userId"),U=()=>{u&&n(q({chatRoomId:u._id,userId:b}))},A=c=>{const m=c.target,g=1,W=4;y(m.value);const F=Math.min(W,Math.max(g,m.scrollHeight/24));d(F),t.current=F},$=()=>{if(l.trim()==="")return;const c={userId:b,roomId:u._id,message:{messageOwner:"user",messageType:"text",messageText:l}};n({type:D,payload:c}),o.emit("userMessage",c),y(""),d(1)},H=()=>{if(i){I(!0);const c=new FormData;c.append("chatImageURL",i),z(c).then(m=>{const g={userId:b,roomId:u._id,message:{messageOwner:"user",messageType:"image",messageText:m.imageURL}};n({type:D,payload:g}),o.emit("userMessage",g)}).catch(()=>E.error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–æ—Ç–æ. –°–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏")).finally(()=>{h(null),r(!1),S(null),I(!1)})}},O=c=>{const m=c.target.files[0];h(m),r(!0);const g=URL.createObjectURL(m);S(g)},_=()=>{p.current&&p.current.click()},B=()=>{l.trim()!==""&&d(t.current)},J=()=>{x(!f)};return e.jsx(e.Fragment,{children:R?e.jsx(P,{}):e.jsxs("footer",{className:"absolute bottom-0 w-full",children:[e.jsxs("div",{className:"relative items-center bg-mainColors-staticWhite",children:[e.jsx("textarea",{className:"input-style",type:"text",placeholder:"–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è",rows:j,value:l,onChange:A,onFocus:B,onBlur:()=>d(1)}),!l&&!a&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"icon-style",style:{right:"44px"},onClick:J,children:e.jsx(Q,{colorFill:f?T.brand:T.primary})}),e.jsxs("button",{className:"icon-style",onClick:_,children:[e.jsx("input",{type:"file",style:{display:"none"},onChange:O,ref:p}),e.jsx(V,{})]})]}),l&&e.jsx("button",{type:"submit",className:"icon-style",onClick:$,children:e.jsx(N,{})}),a&&e.jsx("button",{type:"submit",className:"icon-style",onClick:H,children:e.jsx(N,{})}),C&&e.jsx("div",{className:"bg-mainColors-staticWhite ml-5 py-5",children:e.jsx("img",{src:C,alt:"Uploaded Image"})})]}),f&&e.jsxs("div",{className:"flex gap-3 py-xs justify-center fade-in",children:[e.jsx(Y,{disabled:!0,children:"–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é"}),e.jsx(Z,{to:"/",onClick:U,children:"–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –¥—ñ–∞–ª–æ–≥"})]})]})})},re=()=>{const n=v(),u=w(G),[f,x]=s.useState(!1),[l,y]=s.useState(!1),[j,d]=s.useState(!1),t=w(L),i=s.useRef(null),h=localStorage.getItem("userId");return s.useEffect(()=>{o.emit("authentication",{token:u}),x(!0)},[u]),o.on("authenticationError",({message:a})=>{E.error(a),x(!1)}),s.useEffect(()=>{t||n(K(h))},[t,n,h]),s.useEffect(()=>(o.on("userStatusChanged",({userId:a,isOnline:r})=>{n({type:X,payload:{userId:a,isOnline:r}})}),()=>{o.off("userStatusChanged")}),[n]),s.useEffect(()=>(o.on("managerJoinToChat",a=>{y(!0),n({type:k,payload:a})}),()=>{o.off("managerJoinToChat")}),[n]),s.useEffect(()=>(o.on("disconnectManager",a=>{console.log("üöÄ ~ file: ChatPage.jsx:74 ~ useEffect ~ room:",a),d(!0),n({type:k,payload:a})}),()=>{o.off("disconnectManager")}),[n]),s.useEffect(()=>{if(i.current){const a=i.current.scrollHeight,r=i.current.clientHeight;a>r&&(i.current.scrollTop=a-r)}},[t]),f?e.jsxs("div",{children:[e.jsx(ee,{children:e.jsxs("section",{ref:i,className:"flex flex-col gap-5 py-5 message-container",children:[e.jsx(M,{type:"text",text:te,time:t==null?void 0:t.createdAt}),t&&(t==null?void 0:t.messages.map((a,r)=>{const{_id:C=r,messageOwner:S,messageText:R,messageType:I,createdAt:p=Date.now()}=a;return e.jsx(M,{owner:S==="user"?"–í–∏":`–ú–µ–Ω–µ–¥–∂–µ—Ä ${t.managerName} ${t.managerSurname}`,type:I,text:R,time:p},C)})),l&&e.jsx(M,{type:"text",text:`–î–æ —á–∞—Ç—É –ø—Ä–∏—î–¥–Ω–∞–≤—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä ${t.managerName} ${t.managerSurname}`,time:Date.now()}),j&&e.jsx(M,{type:"text",text:`–ú–µ–Ω–µ–¥–∂–µ—Ä ${t.managerName} ${t.managerSurname} –≤—ñ–¥'—î–¥–Ω–∞–≤—Å—è. –û—á—ñ–∫—É–π—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞...`,time:Date.now()})]})}),e.jsx(se,{})]}):null};export{re as default};
